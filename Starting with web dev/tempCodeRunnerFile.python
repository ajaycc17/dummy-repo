import smtplib
import random
import requests
from email.message import EmailMessage


def email_alert(subject, body, to):
    msg = EmailMessage()
    msg.set_content(body)
    msg['subject'] = subject
    msg['to'] = to

    user = "ajaycc40@gmail.com"
    msg['from'] = user
    password = "najmfitxjlbfzuct"

    server = smtplib.SMTP("smtp.gmail.com", 587)
    server.starttls()
    server.login(user, password)
    server.send_message(msg)

    server.quit()


# fetch facts - 1
def fetch_facts():
    url = "https://facts-by-api-ninjas.p.rapidapi.com/v1/facts"
    headers = {
        "X-RapidAPI-Key": "1e5e6108d1msh42f4a99382ac875p177062jsn0444441b1df8",
        "X-RapidAPI-Host": "facts-by-api-ninjas.p.rapidapi.com"
    }
    fact = requests.request("GET", url, headers=headers)
    fact = fact.json()[0]['fact']
    return fact

# fetch joke - 2


def fetch_jokes():
    url = "https://jokes-by-api-ninjas.p.rapidapi.com/v1/jokes"
    headers = {
        "X-RapidAPI-Key": "1e5e6108d1msh42f4a99382ac875p177062jsn0444441b1df8",
        "X-RapidAPI-Host": "jokes-by-api-ninjas.p.rapidapi.com"
    }
    joke = requests.request("GET", url, headers=headers)
    joke = joke.json()[0]['joke']
    return joke

# fetch joke2 - 3


def fetch_jokes2():
    url = "https://official-joke-api.appspot.com/random_joke"
    joke = requests.request("GET", url)
    setup = joke.json()['setup']
    punchline = joke.json()['punchline']
    joke = setup+"\n"+punchline
    return joke

# fetch dad_joke - 4


def fetch_dadjoke():
    url = "https://dad-jokes-by-api-ninjas.p.rapidapi.com/v1/dadjokes"
    headers = {
        "X-RapidAPI-Key": "1e5e6108d1msh42f4a99382ac875p177062jsn0444441b1df8",
        "X-RapidAPI-Host": "dad-jokes-by-api-ninjas.p.rapidapi.com"
    }
    response = requests.request("GET", url, headers=headers)
    joke = response.json()[0]['joke']
    return joke

# cat fact - 5


def cat_fact():
    url = "https://catfact.ninja/fact"
    cat = requests.request("GET", url)
    fact = cat.json()['fact']
    return fact


if __name__ == '__main__':
    subjects = [
        "Gentle reminder for medicine ğŸ§‘ğŸ»â€ğŸš€"
                # "Do not forget about the medicineğŸŒ·"
                ]
    random_sub = random.choice(subjects)

    # select facts or jokes
    choice = [1, 2, 3, 4, 5]
    random_choice = random.choice(choice)
    if (random_choice == 1):
        inp = fetch_facts()
        topic = "Random fact: "
    elif random_choice == 2:
        inp = fetch_jokes()
        topic = "Random joke: "
    elif random_choice == 3:
        inp = fetch_jokes2()
        topic = "Mood lightener: "
    elif random_choice == 4:
        inp = fetch_dadjoke()
        topic = "Dad Joke: "
    else:
        inp = cat_fact()
        topic = "Cat fact: "

    # get content
    cont = ["Did you take your medicine??",
            "Happy to remind you about the medicineğŸ˜Š", "Please take your medicineğŸ’Š..."]
    random_cont = random.choice(cont)

    # send mail
    email_alert(random_sub, "Hi AjayğŸ‘‹...\n"+random_cont +
                "\n\n"+topic+inp, "ajaychoudhury1221@gmail.com")
    # email_alert(random_sub, "Hi AkatağŸ‘‹...\n"+random_cont +
    #             "\n\n"+topic+inp, "akatasaha2000@gmail.com")
